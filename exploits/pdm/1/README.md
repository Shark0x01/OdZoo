# Engineering & Lifecycle Management #1

> [!IMPORTANT]  
> The responsible disclosure policy has been followed when reporting this vulnerability. A patch has been made available by the module's vendor before this repository was made public.

> [!WARNING]
> The information and scripts provided here are intended for research and educational purposes only. 
> Usage of these resources in any way that could compromise the security of a system used in production is strictly prohibited and may lead to legal consequences. 
> The creator of these resources bears no responsibility for any misuse or harm resulting from their utilization.


## CVE ID

**CVE-2023-40958**

## Description
**SQL injection vulnerability** in Didotech srl Engineering & Lifecycle Management (aka `pdm`) v.14.0, v.15.0 and v.16.0 fixed in pdm-14.0.1.0.0, pdm-15.0.1.0.0, and pdm-16.0.1.0.0 allows a remote authenticated attacker to **execute arbitrary code** via the `query` parameter in `models/base_client.py` component.

## Affected product
**Engineering & Lifecycle Management**

## Technical name of affected product
`pdm`

## Link to the Odoo Apps Store
https://apps.odoo.com/apps/modules/16.0/pdm/

## Vulnerability type
SQL injection

## Impact
Privilege Escalation, Information Disclosure

## Affected components: 
- `models/base_client.py:pml_config_settings::setExecute(query)`
- `models/base_client.py:pml_config_settings::getExecute(query)`
- `models/base_client.py:pml_config_settings::getExectuteQuery(query)`

## Attack vectors
A portal user or internal user of an Odoo instance with the `pdm` module installed can trigger one of these methods using the External API, passing the query of its choice to the method which will execute the given SQL query through the database cursor. 


## Proof-of-Concept

> [!NOTE] 
> A recorded demo of the PoC as well as the code for the exploit are available under this directory.

User `lucas` is a portal user and thus has no specific permission and thus has no permission to access the Inventory and Manufacturing modules. User `lucas` sends an XML-RPC to the `plm.config.settings` model through the External API, triggering the `setExecute` method, passing an SQL query that modifies the admin password as argument:


`models.execute_kw(db, uid, password, 'plm.config.settings', 'setExecute', ['plm.config.settings', "UPDATE res_users SET password='whatever' WHERE login='admin'"])`


Since the vulnerable methods are public methods, they can be called from the External API. Also, since permissions are only checked when performing CRUD operations on records of the model and not when invoking methods, the pdm module executes the given SQL query that modifies the admin password. Arbitrary SQL queries can be executed with consequences ranging from information disclosure to data tampering and privilege escalation. 




