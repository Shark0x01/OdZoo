# Engineering & Lifecycle Management #3

> [!IMPORTANT]  
> The responsible disclosure policy has been followed when reporting this vulnerability. A patch has been made available by the module's vendor before this repository was made public.

> [!WARNING]
> The information and scripts provided here are intended for research and educational purposes only. 
> Usage of these resources in any way that could compromise the security of a system used in production is strictly prohibited and may lead to legal consequences. 
> The creator of these resources bears no responsibility for any misuse or harm resulting from their utilization.


## Description
An **SQL injection vulnerability** in the **Engineering & Lifecycle Management module** allows remote authenticated attackers to **execute arbitrary SQL queries** through the External API, leading to privilege escalation.

## Affected product
**Engineering & Lifecycle Management**

## Technical name of affected product
`pdm`

## Link to the Odoo Apps Store
https://apps.odoo.com/apps/modules/16.0/pdm/

## Vulnerability type
SQL injection

## Impact
Privilege Escalation, Information Disclosure

## Affected components: 
- `models/base_client.py, pml_config_settings, GetUpdateTableData(request, default)`

## Attack vectors
A portal user or internal user of an Odoo instance with the `pdm` module installed can trigger the `GetUpdateTableData` method using the External API, passing a crafted `request` parameter containing an SQL query of its choice that will be injected to the existing SQL query and executed through the database cursor. 


## Proof-of-Concept

> [!NOTE] 
> A recorded demo of the PoC as well as the code for the exploit are available under this directoy

User `lucas` is a portal user and thus has no specific permission and thus has no permission to access the Inventory and Manufacturing modules. User `lucas` sends an XML-RPC to the `plm.config.settings` model through the External API, triggering the `GetUpdateTableData` method, passing a crafted `request` parameter that modifies the admin password through an injected SQL query.

`models.execute_kw(db, uid, password, 'plm.config.settings', 'GetUpdateTableData', [["ext_document", "2023-08-02'; UPDATE res_users SET password='whatever' WHERE login='admin'; SELECT password FROM res_users WHERE login='admin'; -- "]])`

Since the vulnerable method is a public method, it can be called from the External API. Arbitrary SQL queries can be executed with consequences ranging from information disclosure to data tampering and privilege escalation. A possible patch could make use of prepared statements or make the affected method private to be no longer callable from the External API. 




