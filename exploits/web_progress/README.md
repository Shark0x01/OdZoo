# Dynamic Progress Bar

> [!IMPORTANT]  
> The responsible disclosure policy has been followed when reporting this vulnerability. A patch has been made available by the module's vendor before this repository was made public.

> [!WARNING]
> The information and scripts provided here are intended for research and educational purposes only. 
> Usage of these resources in any way that could compromise the security of a system used in production is strictly prohibited and may lead to legal consequences. 
> The creator of these resources bears no responsibility for any misuse or harm resulting from their utilization.


## CVE ID
**CVE-2023-40954**

## Description
**SQL injection vulnerability** in Grzegorz Marczynski Dynamic Progress Bar (aka `web_progress`) v. 11.0 thru 11.0.2, v.12.0 thru 12.0.2, v.13.0 thru 13.0.2, v.14.0 thru 14.0.2.1, v.15.0 thru 15.0.2, v.16.0 thru 16.0.2.1 allows a remote attacker to **gain privileges** via the `recency` parameter in `models/web_progress.py` component.

> [!NOTE] 
> Versions made available on the Odoo Apps Store from August 5th 2023 are patched.

## Affected product
**Dynamic Progress Bar**

## Technical name of affected product
`web_progress`

## Link to the Odoo Apps Store
https://apps.odoo.com/apps/modules/16.0/web_progress/

## Vulnerability type
SQL injection

## Impact
Privilege Escalation, Information Disclosure

## Affected components: 
`models/web_progress.py, WebProgress, get_all_progress(recency)`

## Attack vectors
A portal user or internal user of an Odoo instance with the `web_progress` module installed on it can trigger the `get_all_progress` method using the External API, passing a crafted `recency` argument to the method to inject the SQL query of its choice that will be executed through the database cursor. 


## Proof-of-Concept

> [!NOTE] 
> A recorded demo of the PoC as well as the code for the exploit are available under this directoy

User `lucas` is a portal user and thus has no specific permission. User lucas sends an XML-RPC to the `web.progress` model through the External API , triggering the `get_all_progress` method. It passes a crafted `recency` argument that injects an SQL query modifying the admin password before executing the original intended query:


`models.execute_kw(db, uid, password, 'web.progress', 'get_all_progress', ["1 SECOND' GROUP BY code; UPDATE res_users SET password='whatever' WHERE login='admin'; SELECT code, array_agg(state) FROM web_progress WHERE create_date > timezone('utc', now()) - INTERVAL '1 "])`


Since the vulnerable method is a public method, it can be called from the External API. Also, since the database cursor is directly employed, no access rights checking is performed. No user input validation or sanitation is performed, allowing the attacker to inject arbitrary SQL queries, with consequences ranging from information disclosure to data tampering and privilege escalation. A possible patch could make use of prepared statements or make the affected method private to be no longer callable from the External API.




